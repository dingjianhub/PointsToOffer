# 1179 ï¼šé‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨

---

[leetcode-cn é¢˜ç›®åœ°å€](https://leetcode-cn.com/problems/reformat-department-table/)

ğŸ“—difficultyï¼š**Easy**	

ğŸ¯Tagsï¼š

+ IF è¯­å¥
+ CASE è¯­å¥
+ GROUP BY è¯­å¥
+ è¡Œåˆ—è½¬ç½®



---

## 1. é¢˜ç›®æè¿°ğŸ“ƒ

éƒ¨é—¨è¡¨ `Department`ï¼š

```mysql
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| revenue       | int     |
| month         | varchar |
+---------------+---------+
(id, month) æ˜¯è¡¨çš„è”åˆä¸»é”®ã€‚
è¿™ä¸ªè¡¨æ ¼æœ‰å…³äºæ¯ä¸ªéƒ¨é—¨æ¯æœˆæ”¶å…¥çš„ä¿¡æ¯ã€‚
æœˆä»½ï¼ˆmonthï¼‰å¯ä»¥å–ä¸‹åˆ—å€¼ ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]ã€‚
```

ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥é‡æ–°æ ¼å¼åŒ–è¡¨ï¼Œä½¿å¾—æ–°çš„è¡¨ä¸­æœ‰ä¸€ä¸ªéƒ¨é—¨ id åˆ—å’Œä¸€äº›å¯¹åº” **æ¯ä¸ªæœˆ** çš„æ”¶å…¥ï¼ˆrevenueï¼‰åˆ—ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼š

```mysql
Department è¡¨ï¼š
+------+---------+-------+
| id   | revenue | month |
+------+---------+-------+
| 1    | 8000    | Jan   |
| 2    | 9000    | Jan   |
| 3    | 10000   | Feb   |
| 1    | 7000    | Feb   |
| 1    | 6000    | Mar   |
+------+---------+-------+

æŸ¥è¯¢å¾—åˆ°çš„ç»“æœè¡¨ï¼š
+------+-------------+-------------+-------------+-----+-------------+
| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |
+------+-------------+-------------+-------------+-----+-------------+
| 1    | 8000        | 7000        | 6000        | ... | null        |
| 2    | 9000        | null        | null        | ... | null        |
| 3    | null        | 10000       | null        | ... | null        |
+------+-------------+-------------+-------------+-----+-------------+

æ³¨æ„ï¼Œç»“æœè¡¨æœ‰ 13 åˆ— (1ä¸ªéƒ¨é—¨ id åˆ— + 12ä¸ªæœˆä»½çš„æ”¶å…¥åˆ—)ã€‚
```



---

## 2. è§£é¢˜æ€è·¯ğŸ’¡

### è¡Œåˆ—è½¬ç½®

å°†åŸæœ¬çš„è¡Œæ•°æ®è½¬æ¢ä¸ºåˆ—æ•°æ®ï¼Œå°†åˆ—æ•°æ®è½¬æ¢ä¸ºè¡Œæ•°æ®ã€‚



#### ä»£ç å®ç°

##### CASE è¯­å¥

ä¸€ç§æ˜¯ä½¿ç”¨ `CASE` è¯­å¥ã€‚å…¶æ¡†æ¶ä¸ºï¼š

```mysql
CASE  case_expression
   WHEN when_expression_1 THEN commands
   WHEN when_expression_2 THEN commands
   ...
   ELSE commands
END CASE;
```

`case_expression`å¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„è¡¨è¾¾å¼ã€‚æˆ‘ä»¬å°†`case_expression`çš„å€¼ä¸æ¯ä¸ª`WHEN`å­å¥ä¸­çš„`when_expression`è¿›è¡Œæ¯”è¾ƒï¼Œä¾‹å¦‚`when_expression_1`ï¼Œ`when_expression_2`ç­‰ã€‚å¦‚æœ`case_expression`å’Œ`when_expression_n`çš„å€¼ç›¸ç­‰ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„`WHEN`åˆ†æ”¯ä¸­çš„å‘½ä»¤(`commands`)ã€‚

å¦‚æœ`WHEN`å­å¥ä¸­çš„`when_expression`ä¸`case_expression`çš„å€¼éƒ½ä¸åŒ¹é…ï¼Œåˆ™`ELSE`å­å¥ä¸­çš„å‘½ä»¤å°†è¢«æ‰§è¡Œã€‚`ELSE`å­å¥æ˜¯å¯é€‰çš„ã€‚ å¦‚æœçœç•¥`ELSE`å­å¥ï¼Œå¹¶ä¸”æ‰¾ä¸åˆ°åŒ¹é…é¡¹ï¼ŒMySQLå°†å¼•å‘é”™è¯¯ã€‚



å¯¹äºæœ¬é¢˜çš„éœ€æ±‚ï¼Œå¯ä»¥å†™æˆè¿™æ ·çš„ `CASE` è¯­å¥ã€‚å³å¯¹æ¯ä¸€åˆ—çš„æ•°æ®è¿›è¡Œè¡Œåˆ—è½¬æ¢ã€‚

```mysql
SELECT id,
       CASE `month` WHEN 'Jan' THEN revenue END Jan_Revenue,
       CASE `month` WHEN 'Feb' THEN revenue END Feb_Revenue,
       CASE `month` WHEN 'Mar' THEN revenue END Mar_Revenue,
       CASE `month` WHEN 'Apr' THEN revenue END Apr_Revenue,
       CASE `month` WHEN 'May' THEN revenue END May_Revenue,
       CASE `month` WHEN 'Jun' THEN revenue END Jun_Revenue,
       CASE `month` WHEN 'Jul' THEN revenue END Jul_Revenue,
       CASE `month` WHEN 'Aug' THEN revenue END Aug_Revenue,
       CASE `month` WHEN 'Sep' THEN revenue END Sep_Revenue,
       CASE `month` WHEN 'Oct' THEN revenue END Oct_Revenue,
       CASE `month` WHEN 'Nov' THEN revenue END Nov_Revenue,
       CASE `month` WHEN 'Dec' THEN revenue END Dec_Revenue
FROM Department;
```

##### IF è¯­å¥

å¦å¤–ä¸€ç§æ˜¯ä½¿ç”¨ `IF` è¯­å¥ã€‚

`IF` è¯­å¥æœ‰ä¸‰ä¸ªè¡¨è¾¾å¼ï¼Œ`IF (epx1,exp2,epx3)`ï¼Œå‚è€ƒ `Java` ä¸­çš„ä¸‰å…ƒè¿ç®— `? : :` ã€‚`exp1` æ˜¯è¦åˆ¤æ–­çš„è¯­å¥ï¼Œå¦‚æœæˆç«‹ï¼Œé‚£ä¹ˆè¿”å› `exp2` çš„å€¼ï¼Œå¦åˆ™è¿”å› `exp3` çš„å€¼ã€‚



```mysql
SELECT id,
       IF(`month` = 'Jan', revenue, NULL) Jan_Revenue,
       IF(`month` = 'Feb', revenue, NULL) Feb_Revenue,
       IF(`month` = 'Mar', revenue, NULL) Mar_Revenue,
       IF(`month` = 'Apr', revenue, NULL) Apr_Revenue,
       IF(`month` = 'May', revenue, NULL) May_Revenue,
       IF(`month` = 'Jun', revenue, NULL) Jun_Revenue,
       IF(`month` = 'Jul', revenue, NULL) Jul_Revenue,
       IF(`month` = 'Aug', revenue, NULL) Aug_Revenue,
       IF(`month` = 'Sep', revenue, NULL) Sep_Revenue,
       IF(`month` = 'Oct', revenue, NULL) Oct_Revenue,
       IF(`month` = 'Nov', revenue, NULL) Nov_Revenue,
       IF(`month` = 'Dec', revenue, NULL) Dec_Revenue
FROM Department;
```



ä½¿ç”¨ä¸Šè¿°çš„è¯­å¥åï¼Œè·å¾—çš„ç»“æœï¼š

![](https://assets.ryantech.ltd/20200905093554.png)



æ¥ä¸‹æ¥ï¼Œéœ€è¦å¯¹ç»“æœè¿›è¡Œåˆå¹¶æ“ä½œã€‚

ä½¿ç”¨ `GROUP BY id`ï¼Œå°†å…¶æŒ‰ç…§ `id` åˆå¹¶åˆ°ä¸€èµ·å³å¯ã€‚å› ä¸ºä½¿ç”¨ `GROUP BY`  éœ€è¦ä½¿ç”¨åˆ°èšåˆå‡½æ•°ã€‚é‚£ä¹ˆæ€è€ƒè¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœç»™å®šçš„æ•°æ®è¡¨æ ¼çš„æ•°æ®ä¸­å«æœ‰é‡å¤çš„æ•°æ®å‘¢ï¼Ÿä¾‹å¦‚ï¼š`id  = 1` çš„å‘˜å·¥ï¼Œä»–çš„å·¥èµ„æœ‰  2 éƒ¨åˆ†ï¼Œéƒ½åœ¨ `May` æœˆå‘ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ `SUM()` è®¡ç®—å…¶æ€»æ•°ã€‚å¦‚æœåœ¨ç¡®ä¿æ•°æ®éƒ½æ˜¯åˆç†åˆæ³•æ²¡æœ‰é‡å¤çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ `MAX()` ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ `GROUP BY` ï¼Œå¹¶ä¸”æœ€ç»ˆè¿”å›æ­£ç¡®çš„å€¼ã€‚



---

## 3. æ€»ç»“ğŸ¯

